<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>Predicci√≥n de Precios de Vuelos ‚úàÔ∏è</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    />
    <style>
      body {
        background: linear-gradient(to right, #6dd5fa, #2980b9);
        font-family: "Segoe UI", sans-serif;
        color: #fff;
        min-height: 100vh;
      }
      .container {
        background: rgba(255, 255, 255, 0.15);
        backdrop-filter: blur(6px);
        border-radius: 20px;
        padding: 30px;
        max-width: 700px;
        margin-top: 50px;
      }
      h1 {
        font-weight: bold;
        margin-bottom: 30px;
        text-align: center;
      }
      label {
        font-weight: 500;
        color: #fff;
      }
      .btn-primary {
        background-color: #004aad;
        border: none;
      }
      .btn-primary:hover {
        background-color: #003a88;
      }
      .resultado {
        margin-top: 30px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 15px;
        padding: 20px;
        text-align: center;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Predicci√≥n de Precios de Vuelos ‚úàÔ∏è</h1>
      <form id="formulario">
        <div class="row mb-3">
          <div class="col-md-6">
            <label for="aerolinea">Aerol√≠nea</label>
            <select id="aerolinea" class="form-select" required></select>
          </div>
          <div class="col-md-6">
            <label for="fecha">Fecha del vuelo</label>
            <input type="date" id="fecha" class="form-control" required />
          </div>
        </div>

        <div class="row mb-3">
          <div class="col-md-6">
            <label for="origen">Origen</label>
            <select id="origen" class="form-select" required></select>
          </div>
          <div class="col-md-6">
            <label for="destino">Destino</label>
            <select id="destino" class="form-select" required></select>
          </div>
        </div>

        <div class="row mb-3">
          <div class="col-md-6">
            <label for="hora_salida">Hora de salida</label>
            <input type="time" id="hora_salida" class="form-control" required />
          </div>
          <div class="col-md-3">
            <label for="duracion">Duraci√≥n (h)</label>
            <input
              type="number"
              id="duracion"
              class="form-control"
              min="0"
              step="0.1"
              required
            />
          </div>
          <div class="col-md-3">
            <label for="escalas">Escalas</label>
            <input
              type="number"
              id="escalas"
              class="form-control"
              min="0"
              max="3"
              required
            />
          </div>
        </div>

        <div class="mb-3">
          <label for="informacion">Informaci√≥n adicional</label>
          <select id="informacion" class="form-select" required></select>
        </div>

        <div class="text-center">
          <button type="submit" class="btn btn-primary px-4">
            Predecir Precio
          </button>
        </div>
      </form>

      <div id="resultado" class="resultado d-none">
        <h4 id="textoResultado"></h4>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", async () => {
        // Cargar opciones desde /api/datos
        try {
          const resp = await fetch("/api/datos");
          const data = await resp.json();

          if (data.error) {
            alert("‚ùå Error al cargar datos: " + data.error);
            return;
          }

          // Llenar selectores
          llenarSelect("aerolinea", data.aerolineas);
          llenarSelect("origen", data.origenes);
          llenarSelect("destino", data.destinos);
          llenarSelect("informacion", data.informaciones);
        } catch (err) {
          alert("Error cargando datos iniciales: " + err);
        }
      });

      function llenarSelect(id, valores) {
        const select = document.getElementById(id);
        valores.forEach((v) => {
          const option = document.createElement("option");
          option.value = v;
          option.textContent = v;
          select.appendChild(option);
        });
      }

      // Manejar env√≠o del formulario
      document
        .getElementById("formulario")
        .addEventListener("submit", async (e) => {
          e.preventDefault();

          const datos = {
            aerolinea: document.getElementById("aerolinea").value,
            origen: document.getElementById("origen").value,
            destino: document.getElementById("destino").value,
            fecha: document.getElementById("fecha").value,
            duracion: document.getElementById("duracion").value,
            escalas: document.getElementById("escalas").value,
            informacion: document.getElementById("informacion").value,
            hora_salida: document.getElementById("hora_salida").value,
          };

          try {
            const resp = await fetch("/api/predecir", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(datos),
            });

            const resultado = await resp.json();
            const divResultado = document.getElementById("resultado");
            const texto = document.getElementById("textoResultado");

            if (resultado.exito) {
              divResultado.classList.remove("d-none");
              texto.innerHTML = `
                üí∞ Precio estimado: <strong>S/ ${resultado.precio}</strong><br>
                üõ´ Ruta: ${resultado.ruta}<br>
                üìÖ Fecha: ${resultado.fecha}<br>
                ‚úàÔ∏è Aerol√≠nea: ${resultado.aerolinea}
            `;
            } else {
              divResultado.classList.remove("d-none");
              texto.innerHTML = `<span class="text-warning">‚ö†Ô∏è Error al predecir: ${resultado.error}</span>`;
            }
          } catch (err) {
            alert(
              "Error al predecir el precio. Verifica los datos ingresados."
            );
            console.error(err);
          }
        });
    </script>
  </body>
</html>
